/*!
    jQuery Tag This
    Copyright 2014 Dan Gribbin - dangribbin@gmail.com
    Licensed under the MIT license:
    http://www.opensource.org/licenses/mit-license.php
    Hat tip to jQuery Tags Input Plugin by XOXCO, Inc.
*/
(function(n){"use strict";var r,t=[],u=[],f=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i,e=[37,39,8,46];n.fn.tagThis=function(f){var o=jQuery.extend({interactive:!0,defaultText:"type to tag",createTagWith:",",hideOriginal:!0,noDuplicates:!1,removeWithBackspace:!0,regex:"",maxChars:0,maxTags:0,width:"300px",height:"100px"},f);return this.each(function(){var r,s,h,f,c,l;if(n(this).data("settings",o),o.hideOriginal&&n(this).hide(),r=n(this).attr("id"),(!r||u[n(this).attr("id")])&&(r=n(this).attr("id","tags"+(new Date).getTime()).attr("id")),s=jQuery.extend({wrapper:"#tag-this--"+r,realInput:"#"+r,fakeInput:"#"+r+"--tag"},o),u[r]=s.createTagWith,o.callbacks&&(o.callbacks.beforeAddTag||o.callbacks.afterAddTag||o.callbacks.onChange||o.callbacks.afterRemoveTag||o.callbacks.beforeRemoveTag||o.callbacks.errors)&&(t[r]=[],t[r].beforeAddTag=o.callbacks.beforeAddTag,t[r].afterAddTag=o.callbacks.afterAddTag,t[r].afterRemoveTag=o.callbacks.afterRemoveTag,t[r].onChange=o.callbacks.onChange,t[r].beforeRemoveTag=o.callbacks.beforeRemoveTag,t[r].errors=o.callbacks.errors),h='<div id="tag-this--'+r+'" class="tag-this"><div id="'+r+'--addTag">',o.email&&n(this).data("type","email"),o.interactive&&(h=h+'<input id="'+r+'--tag" value="" data-default="'+o.defaultText+'" />'),h=h+'<\/div><div class="tag-this--clear"><\/div><\/div><div class="tag-this--error"><\/div>',n(h).insertAfter(this),o.interactive){f=n(s.fakeInput);c=n(s.realInput);i=f.css("width");f.val(f.attr("data-default"));n(s.wrapper).on("click",s,function(t){n(t.data.fakeInput).focus()});f.on("focus",s,function(t){var i=n(t.data.fakeInput);i.val()===i.attr("data-default")&&i.val("")}).on("keyup.arrowKeys",function(t){var i=n(this).parent(),r,u;t.which===37&&n(this).val()===""?(r=i.prev(".tag"),r&&i.after(r)):t.which===39&&n(this).val()===""?(r=i.next(".tag"),r&&i.before(r)):t.keyCode===8&&n(this).val()===""?(u=i.prev(".tag"),u&&u.find(".tag-this--remove-tag").trigger("click")):t.keyCode===46&&n(this).val()===""&&(u=i.next(".tag"),u&&u.find(".tag-this--remove-tag").trigger("click"))});if(o.autocompleteSource)if(l={source:o.autocompleteSource,select:function(n,t){n.preventDefault();c.addTag(t.item.value);f.focus()}},jQuery.ui.autocomplete)f.autocomplete(l);else throw new Error("jQuery-Tag-This is missing the jQuery UI dependecy needed for autocomplete to work. If you don't need autocomplete, don't set the autocompleteSource setting.");f.on("blur",s,function(t){var r=n(this).attr("data-default"),i=n(t.data.fakeInput),u=i.val();return i.val()!==""&&i.val()!==r?n(t.data.realInput).addTag(u):i.val(i.attr("data-default")),!1});f.on("keypress",s,function(t){var i=n(t.data.fakeInput),r=i.val();return n(this).autosizeInput(i),n.inArray(t.which,t.data.createTagWith)>0&&n.inArray(t.which,e)<0||t.which===13||t.which===44?(t.preventDefault(),n(t.data.realInput).addTag(r),!1):void 0});f.on("keyup",s,function(t){var i=n(t.data.fakeInput);n(this).autosizeInput(i)});f.on("keydown",function(t){t.keyCode===8&&n(this).removeClass("tag-this--invalid")});if(s.noDuplicates)f.on("keydown",function(t){(t.keyCode===8||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/))&&n(this).removeClass("tag-this--invalid")})}}),f&&f.width&&f.height&&(r=n("#tag-this--"+this[0].id),n(r).css({width:f.width,height:f.height})),this};n.fn.addTag=function(i){var r=n(this).data("settings");return this.each(function(){var u=n(this).attr("id"),e,f,o,s,h,c,l;if(n("#"+u+"--tag").removeClass("tag-this--invalid"),h=n(this).data("tags"),f=h?h:[],r.callbacks&&t[u]&&t[u].beforeAddTag&&(o=t[u].beforeAddTag,s={context:n(this),tags:f,attemptedInput:i},o.call(this,s)),c=n(this).validateAddTag(i,r,f),c.tagIsInvalid)return e=n("#"+u+"--tag"),e.addClass("tag-this--invalid"),e.trigger("focus"),n(this).relayError(u,i,r,f,c.errors),!1;i&&(i.id||(l=n.fn.tagThis.generateUniqueTagId(f),i={id:l,text:i}),n("<span>").addClass("tag").attr("data-id",i.id).append(n("<span>").text(i.text),n("<button>",{title:"Click to remove "+i.text,text:"x","class":"tag-this--remove-tag"}).on("click",function(){return n("#"+u).removeTag(i)})).insertBefore("#"+u+"--addTag"),f.push(i),n("#"+u+"--tag").val(""),n(this).data("tags",f),e=n("#"+u+"--tag"),e.trigger("focus"),n(this).resetInputSize(e),r.callbacks&&t[u]&&t[u].afterAddTag&&(o=t[u].afterAddTag,s={context:n(this),tags:f,addedInput:i},o.call(this,s)),t[u]&&t[u].onChange&&(o=t[u].onChange,s={context:n(this),tags:f,addedInput:i},o.call(this,s)))}),!1};n.fn.validateAddTag=function(t,i,r){var u={},f,o,s,h,e;return u.maxTagsReached=!1,u.maxCharsReached=!1,u.failedCustomRegex=!1,u.emailIsInvalid=!1,u.isDuplicate=!1,!i.regex||i.email||t.id||(o=n(this).failedCustomRegex(t,i),o&&(f=!0,u.failedCustomRegex=!0)),i.email&&(s=n(this).emailIsInvalid(t),s&&(f=!0,u.emailIsInvalid=!0)),i.noDuplicates&&(h=n(this).tagExists(i,t),h===!0&&(f=!0,u.isDuplicate=!0)),i.maxTags&&i.maxTags===r.length&&(f=!0,u.maxTagsReached=!0),i.maxChars>0&&(e=!1,e=t.id?t.text.length>i.maxChars:t.length>i.maxChars,e&&(u.maxCharsReached=!0,f=!0)),{tagIsInvalid:f,errors:u}};n.fn.removeTag=function(i){return this.each(function(){var u=n(this).attr("id"),f,e,r,o,s;if(t[u]&&t[u].beforeRemoveTag&&(f=t[u].beforeRemoveTag,e={context:n(this),tags:r,inputToBeRemoved:i},f.call(this,e)),r=n(this).data("tags"),r){if(i.id)for(n("#tag-this--"+u+' .tag[data-id="'+i.id+'"]').remove(),o=0;o<r.length;o++)r[o].id===i.id&&r.splice(o,1);else for(n("#tag-this--"+u+" .tag").each(function(){n(this).find("span").text()===i&&n(this).remove()}),s=0;s<r.length;s++)r[s].text===i&&r.splice(s,1);n(this).data("tags",r);r&&t[u]&&t[u].afterRemoveTag&&(f=t[u].afterRemoveTag,e={context:n(this),tags:r,removedInput:i},f.call(this,e));t[u]&&t[u].onChange&&(f=t[u].onChange,e={context:n(this),tags:r,removedInput:i},f.call(this,e))}}),!1};n.fn.tagExists=function(t,i){var r=n(this).data("tags"),u,f;if(!r)return!1;if(t.interactive||!i.id){for(u=0;u<r.length;u++)if(r[u].text===i)return!0}else if(i.id)for(f=0;f<r.length;f++)if(r[f].id===i.id)return!0;return!1};n.fn.autosizeInput=function(n){var t=n.val().length,r=t?t*7+40:i;n.css("width",r>parseInt(i)?r:i)};n.fn.resetInputSize=function(n){n.css("width",i)};n.fn.emailIsInvalid=function(n){var t=f.test(n);return t?!1:!0};n.fn.failedCustomRegex=function(n,t){var i=t.regex,r=i.test(n);return r?!1:!0};n.fn.relayError=function(n,i,r,u,f){if(r.callbacks&&t[n]&&t[n].errors){var e={id:n,attemptedToTag:i,settings:r,tags:u,errors:f},o=t[n].errors;o.call(this,e)}};n.fn.clearAllTags=function(){var i=n(this).attr("id"),r=n("#tag-this--"+i),f=n("#"+i+"--tag"),t=r.parent().find(".tag-this--invalid"),u;r.find(".tag").remove();n(this).data("tags","");t&&(u=t.data("default"),t.removeClass("tag-this--invalid").val(u),t.trigger("blur"));n(this).resetInputSize(f)};n.fn.tagThis.generateUniqueTagId=function(t){for(var r=1,u=Math.floor(Math.random()*(7001-r))+r,i=0;i<t.length;i++)t[i].id===u&&i<1e3&&n(this).generateUniqueTagId();return u};n.fn.destroy=function(){n(this).next().remove();n(this).show()};n.tagThisDestroyAll=function(){n(".tag-this").each(function(){n(this).prev().show();n(this).remove()})}})(jQuery);
//# sourceMappingURL=jquery.tagthis.min.js.map
